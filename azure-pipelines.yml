# azure-pipelines.yml
trigger:
  branches:
    include:
      - main  # change selon ta branche principale

pool:
  vmImage: 'ubuntu-latest'

variables:
  MAVEN_OPTS: '-Xmx1024m'
  JAR_FILE: 'target/AnnotationPlatfrom-0.0.1-SNAPSHOT.jar'

steps:
# 1️⃣ Checkout du code
- task: Checkout@1
  displayName: 'Checkout repository'

# 2️⃣ Build Maven
- task: Maven@3
  displayName: 'Build Maven project'
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean package'
    options: '-DskipTests'

# 3️⃣ Run tests (optionnel si tu veux tester)
- task: Maven@3
  displayName: 'Run Tests'
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'test'

# 4️⃣ Publish artifact
- task: PublishBuildArtifacts@1
  displayName: 'Publish JAR artifact'
  inputs:
    pathToPublish: '$(JAR_FILE)'
    artifactName: 'drop'
    publishLocation: 'Container'

# 5️⃣ Deploy to Azure App Service
- task: AzureWebApp@1
  displayName: 'Deploy to Azure App Service'
  inputs:
    azureSubscription: 'AzureConnectionAnnotation' # configurer dans Azure DevOps
    appName: 'annotation-platform-app'          # nom de ton App Service
    package: '$(JAR_FILE)'
