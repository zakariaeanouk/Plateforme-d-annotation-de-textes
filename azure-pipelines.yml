# azure-pipelines.yml
trigger:
  branches:
    include:
      - main  # change selon ta branche principale

pool:
  name: Default

variables:
  MAVEN_OPTS: '-Xmx1024m'
  JAR_FILE: 'target/AnnotationPlatfrom-0.0.1-SNAPSHOT.jar'

steps:
# 1Ô∏è‚É£ Checkout du code
- checkout: self
  displayName: 'Checkout repository'

# 2Ô∏è‚É£ Build Maven
- task: Maven@3
  displayName: 'Build Maven project'
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'clean package'

# 3Ô∏è‚É£ Run tests (optionnel si tu veux tester)
- task: Maven@4
  displayName: 'Run Tests'
  inputs:
    mavenPomFile: 'pom.xml'
    goals: 'test'

# 4Ô∏è‚É£ Publish artifact
- task: PublishBuildArtifacts@1
  displayName: 'Publish JAR artifact'
  inputs:
    pathToPublish: '$(JAR_FILE)'
    artifactName: 'drop'
    publishLocation: 'Container'

# 5Ô∏è‚É£ Deploy to Azure App Service
- task: AzureWebApp@1
  displayName: 'Deploy to Azure App Service'
  inputs:
    azureSubscription: 'AzureConnectionAnnotation' # nom exact de ta connexion de service
    appName: 'annotation-platform-app'             # nom exact de ton App Service
    package: '$(JAR_FILE)'
    deployToSlotOrASE: true
    resourceGroupName: 'cloud.projet'
    slotName: 'production'
                      # üëà force le d√©ploiement sur la slot principale

